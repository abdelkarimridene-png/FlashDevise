<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashDevise | Intelligence Marché</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { background: #05070a; color: white; font-family: 'Inter', sans-serif; }
        .glass-card { background: #0f141c; border: 1px solid #1e293b; border-radius: 1rem; height: 100%; }
        .status-bar { border-top: 1px solid #1e293b; background: #0a0e14; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-7xl mx-auto space-y-6">
        
        <header class="flex justify-between items-center py-4 border-b border-white/5">
            <h1 class="font-black italic text-2xl uppercase">FLASH<span class="text-indigo-500">DEVISE</span></h1>
            <div class="flex items-center gap-2">
                <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <span class="text-[10px] font-bold opacity-50 uppercase tracking-widest">Live Analysis Feed</span>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-card p-6">
                    <div class="flex gap-4 mb-6">
                        <select id="fromCur" class="flex-1 bg-slate-800 p-3 rounded-lg font-bold border-none outline-none"></select>
                        <select id="toCur" class="flex-1 bg-slate-800 p-3 rounded-lg font-bold border-none outline-none"></select>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div id="price-display" class="text-5xl font-black text-indigo-400">0.00</div>
                        <div id="rate-text" class="text-[10px] opacity-40 uppercase mt-2 font-bold tracking-tighter">Connexion...</div>
                    </div>

                    <div class="tradingview-widget-container" id="tech-analysis-box">
                        <div class="tradingview-widget-container__widget"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8">
                <div class="glass-card min-h-[500px]" id="main-chart">
                    </div>
            </div>

            <div class="lg:col-span-12">
                <div class="glass-card p-6">
                    <h2 class="text-sm font-bold mb-6 uppercase tracking-widest text-indigo-500">Flux d'actualités mondiales</h2>
                    <div id="news-feed-container" class="h-[400px]">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const assets = ["EUR", "USD", "GBP", "CHF", "JPY", "BTC", "ETH", "XAU"];

        function loadWidgets(from, to) {
            const pair = `${from}${to}`;

            // 1. Analyse Technique (Résumé automatique)
            document.getElementById('tech-analysis-box').innerHTML = ''; 
            const techScript = document.createElement('script');
            techScript.src = "https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js";
            techScript.async = true;
            techScript.innerHTML = JSON.stringify({
                "interval": "1D", "width": "100%", "isTransparent": true, "height": 320,
                "symbol": `FX_IDC:${pair}`, "showIntervalTabs": true, "locale": "fr", "colorTheme": "dark"
            });
            document.getElementById('tech-analysis-box').appendChild(techScript);

            // 2. Graphique Principal
            document.getElementById('main-chart').innerHTML = '';
            new TradingView.widget({
                "autosize": true, "symbol": pair, "interval": "D", "theme": "dark",
                "style": "3", "locale": "fr", "container_id": "main-chart", "hide_top_toolbar": false
            });

            // 3. News (Reuters, CNBC, etc.)
            document.getElementById('news-feed-container').innerHTML = '';
            const newsScript = document.createElement('script');
            newsScript.src = "https://s3.tradingview.com/external-embedding/embed-widget-timeline.js";
            newsScript.async = true;
            newsScript.innerHTML = JSON.stringify({
                "feedMode": "symbol", "symbol": `FX_IDC:${pair}`, "colorTheme": "dark",
                "isTransparent": true, "displayMode": "regular", "width": "100%", "height": 400, "locale": "fr"
            });
            document.getElementById('news-feed-container').appendChild(newsScript);
        }

        async function getLivePrice() {
            const from = document.getElementById('fromCur').value;
            const to = document.getElementById('toCur').value;
            try {
                const r = await fetch(`https://api.exchangerate-api.com/v4/latest/${from}`);
                const d = await r.json();
                const rate = d.rates[to];
                document.getElementById('price-display').innerText = rate.toFixed(4);
                document.getElementById('rate-text').innerText = `LIVE: 1 ${from} = ${rate} ${to}`;
            } catch(e) {}
        }

        window.onload = function() {
            const f = document.getElementById('fromCur'), t = document.getElementById('toCur');
            assets.forEach(a => { f.add(new Option(a, a)); t.add(new Option(a, a)); });
            f.value = "EUR"; t.value = "USD";
            
            const updateAll = () => { getLivePrice(); loadWidgets(f.value, t.value); };
            [f, t].forEach(el => el.onchange = updateAll);
            updateAll();
        };
    </script>
</body>
</html>
