<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashDevise | Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { font-family: sans-serif; background: #05070a; color: white; }
        .glass { background: rgba(15, 20, 28, 0.98); border: 1px solid rgba(255, 255, 255, 0.1); }
        /* Style des badges partenaires sans image */
        .partner-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 900;
            margin-right: 8px;
            text-transform: uppercase;
        }
        .bg-wise { background-color: #00B9FF; color: white; }
        .bg-binance { background-color: #F3BA2F; color: black; }
        .bg-revolut { background-color: #ffffff; color: black; border: 1px solid #ccc; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-5xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <h1 class="font-black italic text-xl uppercase">FLASH<span class="text-indigo-500">DEVISE</span></h1>
            <div class="px-3 py-1 bg-white/5 rounded text-[10px] font-bold opacity-50 uppercase">Terminal Live</div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5 space-y-6">
                <div class="glass p-8 rounded-[2rem]">
                    <div class="text-[10px] font-bold text-slate-500 uppercase mb-6 tracking-widest">Montant à convertir</div>
                    <input type="number" id="amount" value="1000" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-3xl font-black text-white mb-6 outline-none focus:border-indigo-500">
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <select id="fromCurrency" class="bg-slate-800 p-3 rounded-lg text-sm font-bold border-none text-white"></select>
                        <select id="toCurrency" class="bg-slate-800 p-3 rounded-lg text-sm font-bold border-none text-white"></select>
                    </div>

                    <div class="text-center py-6 border-t border-white/5">
                        <div id="resultValue" class="text-4xl font-black text-indigo-400 mb-2">---</div>
                        <div id="baseText" class="text-[10px] font-bold text-slate-500 uppercase">Chargement des taux...</div>
                    </div>
                </div>

                <div class="glass p-6 rounded-[2rem] bg-indigo-500/5 border-indigo-500/20">
                    <a id="mainAffiliateLink" href="#" target="_blank" class="flex items-center justify-center w-full py-4 bg-white text-black rounded-xl font-black text-xs uppercase hover:bg-slate-100 transition">
                        <span id="partnerBadge" class="partner-badge">PARTNER</span>
                        <span id="partnerText">Vérifier le taux</span>
                    </a>
                </div>
            </div>

            <div class="lg:col-span-7">
                <div class="glass h-[450px] rounded-[2rem] overflow-hidden">
                    <div id="tradingview_chart" class="h-full"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Liste des devises simplifiée pour éviter les bugs
        const assets = ["EUR", "USD", "GBP", "CHF", "CAD", "JPY", "BTC", "ETH", "XAU"];

        function updateAffiliate(to) {
            const badge = document.getElementById('partnerBadge');
            const text = document.getElementById('partnerText');
            const link = document.getElementById('mainAffiliateLink');

            if (["BTC", "ETH"].includes(to)) {
                badge.innerText = "BINANCE";
                badge.className = "partner-badge bg-binance";
                text.innerText = "Vérifier sur Binance";
                link.href = "https://www.binance.com";
            } else if (to === "XAU") {
                badge.innerText = "REVOLUT";
                badge.className = "partner-badge bg-revolut";
                text.innerText = "Investir via Revolut";
                link.href = "https://www.revolut.com";
            } else {
                badge.innerText = "WISE";
                badge.className = "partner-badge bg-wise";
                text.innerText = "Transférer via Wise";
                link.href = "https://wise.com";
            }
        }

        async function convert() {
            const amount = document.getElementById('amount').value;
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            updateAffiliate(to);

            try {
                const res = await fetch(`https://api.exchangerate-api.com/v4/latest/${from}`);
                const data = await res.json();
                const rate = data.rates[to] || 1.12; // Taux de secours si l'API échoue
                
                document.getElementById('resultValue').innerText = (amount * rate).toLocaleString(undefined, {maximumFractionDigits:2}) + " " + to;
                document.getElementById('baseText').innerText = `1 ${from} = ${rate.toFixed(4)} ${to}`;
                
                // Mise à jour graphique
                new TradingView.widget({
                    "autosize": true, "symbol": `${from}${to}`, "interval": "D", "theme": "dark",
                    "container_id": "tradingview_chart", "style": "3", "backgroundColor": "#05070a", "locale": "fr"
                });
            } catch(e) { console.log("Erreur API"); }
        }

        function init() {
            const fS = document.getElementById('fromCurrency'), tS = document.getElementById('toCurrency');
            assets.forEach(c => {
                fS.add(new Option(c, c));
                tS.add(new Option(c, c));
            });
            fS.value = "EUR"; tS.value = "USD";
            
            [fS, tS].forEach(s => s.addEventListener('change', convert));
            document.getElementById('amount').addEventListener('input', convert);
            
            convert();
        }

        window.onload = init;
    </script>
</body>
</html>
